<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="renderer" content="webkit|ie-comp|ie-stand">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <title>301医院门诊管理系统 医生列表</title>
  <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="../static/h-ui/css/H-ui.min.css">
  <link rel="stylesheet" href="../static/h-ui.admin/css/H-ui.admin.css">
  <link rel="stylesheet" href="../static/Hui-iconfont/1.0.8/iconfont.css">
  <link rel="stylesheet" href="../static/h-ui.admin/skin/default/skin.css" id="skin">
  <link rel="stylesheet" href="../static/h-ui.admin/css/style.css">
</head>
<body>

<article class="page-container">
  <form method="post" class="form form-horizontal" id="form-doctor-add">
    <input type="hidden" id="doid" name="doid">
    <input type="hidden" id="doexist" name="doexist">
    <div class="row cl">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>医生名:</label>
      <div class="formControls col-xs-8 col-sm-9">
        <input type="text" class="input-text" id="doname" name="doname" style="width: 225px;" placeholder="医生名">
      </div>
    </div>
    <div class="row cl" id="divusername">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>登录用户名:</label>
      <div class="formControls col-xs-8 col-sm-9">
        <input type="text" class="input-text" value="" id="aname" name="aname" style="width: 225px;"
               placeholder="登录用户名">
      </div>
    </div>
    <div class="row cl" id="divpassword">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>登录密码:</label>
      <div class="formControls col-xs-8 col-sm-9">
        <input type="password" class="input-text" value="" id="pwd" name="pwd" style="width: 225px;" placeholder="登录密码">
      </div>
    </div>
    <div class="row cl">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>挂号费:</label>
      <div class="formControls col-xs-8 col-sm-9">
        <input type="number" min="0" step="1" class="input-text" placeholder="挂号费" id="bcost" name="bcost"
               style="width: 225px;">
      </div>
    </div>
    <div class="row cl">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>每小时可挂号人数(网上):</label>
      <div class="formControls col-xs-8 col-sm-9">
        <input type="number" min="0" step="1" class="input-text" placeholder="挂号人数(网上)" id="pcreg"
               name="pcreg" style="width: 225px;">
      </div>
    </div>
    <div class="row cl">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>每小时可挂号人数(现场):</label>
      <div class="formControls col-xs-8 col-sm-9">
        <input type="number" min="0" step="1" class="input-text" placeholder="挂号人数(现场)" id="xcreg"
               name="xcreg" style="width: 225px;">
      </div>
    </div>
    <div class="row cl">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>医生职位:</label>
      <div class="formControls col-xs-8 col-sm-9"><span class="select-box" style="width: 225px;">
				<select class="select" id="title" name="title" size="1" style="width: 215px;">
					<option value="住院医师">住院医师</option>
					<option value="主治医师">主治医师</option>
					<option value="副主任医师">副主任医师</option>
					<option value="主任医师">主任医师</option>
				</select>
				</span>
      </div>
    </div>

    <div class="row cl">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>科室:</label>
      <div class="formControls col-xs-8 col-sm-9"> <span class="select-box" style="width: 225px;">
				<select class="select" size="1" id="deid" name="deid" style="width: 215px;">

				</select>
				</span></div>
    </div>

    <div class="row cl">
      <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>医生简介:</label>
      <div class="formControls col-xs-8 col-sm-9">
        <textarea cols="30" rows="2" id="info" name="info" placeholder="医生简介"></textarea>
      </div>
    </div>

    <div class="row cl">
      <label class="form-label col-xs-4 col-sm-3">值班信息:<br> &nbsp;</label>
      <div class="formControls col-xs-8 col-sm-9" style="width:260px;text-align: center;">
        <dl class="permission-list">
          <dt>
            <label> 全选:&nbsp;
              <input type="checkbox" value="" name="user-Character-0" id="user-Character-0">
            </label> &nbsp;&nbsp;&nbsp;
          </dt>
          <dd>
            <dl class="cl permission-list2">
              <dt>
                周一:
                &nbsp;
                &nbsp;
                <label>上午:&nbsp;<input type="checkbox" value="1" id="monam" name="monam"></label>
                &nbsp;
                &nbsp;
                <label>下午:&nbsp;<input type="checkbox" value="1" id="monpm" name="monpm"></label>
                <br>
                周二:
                &nbsp;
                &nbsp;
                <label>上午:&nbsp;<input type="checkbox" value="1" name="tueam" id="tueam"></label>
                &nbsp;
                &nbsp;
                <label>下午:&nbsp;<input type="checkbox" value="1" name="tuepm" id="tuepm"></label>
                <br>
                周三:
                &nbsp;
                &nbsp;
                <label>上午:&nbsp;<input type="checkbox" value="1" name="wedam" id="wedam"></label>
                &nbsp;
                &nbsp;
                <label>下午:&nbsp;<input type="checkbox" value="1" name="wedpm" id="wedpm"></label>
                <br>
                周四:
                &nbsp;
                &nbsp;
                <label>上午:&nbsp;<input type="checkbox" value="1" name="thuam" id="thuam"></label>
                &nbsp;
                &nbsp;
                <label>下午:&nbsp;<input type="checkbox" value="1" name="thupm" id="thupm"></label>
                <br>
                周五:
                &nbsp;
                &nbsp;
                <label>上午:&nbsp;<input type="checkbox" value="1" name="friam" id="friam"></label>
                &nbsp;
                &nbsp;
                <label>下午:&nbsp;<input type="checkbox" value="1" name="fripm" id="fripm"></label>
                <br>
                周六:
                &nbsp;
                &nbsp;
                <label>上午:&nbsp;<input type="checkbox" value="1" name="satam" id="satam"></label>
                &nbsp;
                &nbsp;
                <label>下午:&nbsp;<input type="checkbox" value="1" name="satpm" id="satpm"></label>
                <br>
                周日:
                &nbsp;
                &nbsp;
                <label>上午:&nbsp;<input type="checkbox" value="1" name="sunam" id="sunam"></label>
                &nbsp;
                &nbsp;
                <label>下午:&nbsp;<input type="checkbox" value="1" name="sumpm" id="sumpm"></label>
                <br>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
    </div>

    <div class="row cl">
      <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
        <input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;保存&nbsp;&nbsp;">
      </div>
    </div>
  </form>
</article>

<script src="../js/jquery-3.3.1.min.js"></script>
<script src="../static/h-ui/js/H-ui.min.js"></script>
<script src="../static/h-ui.admin/js/H-ui.admin.js"></script>
<script src="../static/layer/2.4/layer.js"></script>

<script src="../js/jquery.validation/jquery.validate.js"></script>
<script src="../js/jquery.validation/validate-methods.js"></script>
<script src="../js/jquery.validation/messages_zh.js"></script>
<script src="../js/hospital.js"></script>

<script>
  $(window).on('load', () => {
    var doid = localStorage.getItem("doid")
    localStorage.removeItem("doid")

    $("#doid").val(doid)

    // 加载科室
    $.ajax({
      url: HOST_URL + "departs",
      dataType: "json",
      headers: createAuthorizationTokenHeader(),
      success: function (data) {
        //$("#deid").empty()
        $.each(data, (i, item) => {
          var text = `<option value="${item.deid}">${item.dename}</option>`
          $("#deid").append(text)
        })
      }
    })

    if (doid > 0) {
      $.ajax({
        url: HOST_URL + "doctors/" + doid,
        dataType: "json",
        headers: createAuthorizationTokenHeader(),
        success: function (data) {
          // 不编辑医生用户名和密码
          $("#divusername").hide()
          $("#divpassword").hide()

          // 编辑医生,填充数据
          //$("#doid").val(data.doid)
          $("#doexist").val(data.doexist)
          $("#doname").val(data.doname)
          $("#bcost").val(data.bcost)
          $("#pcreg").val(data.pcreg)
          $("#xcreg").val(data.xcreg)
          $("#title").val(data.title)
          $("#deid").val(data.deid)
          $("#info").val(data.info)

          if (data.monam == 1)
            $("#monam").prop("checked", true)
          if (data.monpm == 1)
            $("#monpm").prop("checked", true)
          if (data.tueam == 1)
            $("#tueam").prop("checked", true)
          if (data.tuepm == 1)
            $("#tuepm").prop("checked", true)
          if (data.wedam == 1)
            $("#wedam").prop("checked", true)
          if (data.wedpm == 1)
            $("#wedpm").prop("checked", true)
          if (data.thuam == 1)
            $("#thuam").prop("checked", true)
          if (data.thupm == 1)
            $("#thupm").prop("checked", true)
          if (data.friam == 1)
            $("#friam").prop("checked", true)
          if (data.fripm == 1)
            $("#fripm").prop("checked", true)
          if (data.satam == 1)
            $("#satam").prop("checked", true)
          if (data.satpm == 1)
            $("#satpm").prop("checked", true)
          if (data.sunam == 1)
            $("#sunam").prop("checked", true)
          if (data.sumpm == 1)
            $("#sumpm").prop("checked", true)
        }
      })
    }

    $('.skin-minimal input').iCheck({
      checkboxClass: 'icheckbox-blue',
      radioClass: 'iradio-blue',
      increaseArea: '20%'
    });

    $("#form-doctor-add").validate({
      rules: {
        doname: {
          required: true,
          minlength: 2,
          maxlength: 16
        },
        bcost: {
          required: true,
        },
        aname: {
          required: true,
        },
        xcreg: {
          required: true,
        },
        pcreg: {
          required: true,
        },
      },
      onkeyup: false,
      focusCleanup: true,
      success: "valid",
      submitHandler: function (form) {
        var doid = $("#doid").val()

        // 默认新增 doid is zero
        var type = 'post'
        var message = '同时为医生创建了一个账户.'

        // 修改 deid not zero
        if (doid > 0) {
          type = 'put'
          message = ''
        }
        $.ajax({
          url: HOST_URL + "doctors",
          type: type,
          data: JSON.stringify(getFormData($(form))),
          dataType: "json",
          contentType: "application/json;charset=utf-8",
          headers: createAuthorizationTokenHeader(),
          success: function (data) {
            if (data.result == 1) {
              layer.msg('保存成功!' + message, {icon: 6, time: 3000});
              setTimeout(function () {
                var index = parent.layer.getFrameIndex(window.name);
                window.parent.location.reload();
                parent.layer.close(index);
              }, 2500)
            } else if (data.result == -1) {
              layer.msg('登录名已存在,无法操作!', {icon: 2, time: 1000});
            }
          },
          error: function () {
            layer.alert("系统出现错误,请联系管理员!");
          }
        });
      }
    });

    $(".permission-list dt input:checkbox").click(function () {
      $(this).closest("dl").find("dd input:checkbox").prop("checked", $(this).prop("checked"));
    });
  })
</script>
</body>
</html>